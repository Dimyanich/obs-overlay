<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>OBS Overlay</title>
<style>
html, body { margin:0; padding:0; background:transparent; overflow:hidden; }
.overlay {
  position:absolute;
  bottom:0; width:1920px; height:150px;
  display:flex; justify-content:center; align-items:center;
  background: rgba(0,0,0,0.82);
}
.player {
  width:192px; display:flex; flex-direction:column; align-items:center; position:relative;
  color:#fff;
}
.photo-wrap { position:relative; width:110px; height:110px; }
.photo { width:110px; height:110px; object-fit:cover; border-radius:12px; }
.dead .photo { filter: grayscale(100%) brightness(0.35); }
.role { position:absolute; top:6px; right:6px; width:26px; height:26px; }
.name { margin-top:6px; font-family:Arial,sans-serif; font-weight:bold; font-size:14px; text-align:center; }
</style>
</head>
<body>

<div class="overlay" id="overlay"></div>

<script src="players.js"></script>
<script>
const overlay = document.getElementById("overlay");
let prevAlive = [];

const roles = {
  "mafia":"roles/mafia.png",
  "sheriff":"roles/sheriff.png",
  "don":"roles/don.png"
};

function loadState(){
  let state = JSON.parse(localStorage.getItem("state"));
  if(!state){
    state = { players: playersData.map((p,i)=>({playerIndex:i, alive:true, role:"peaceful"})) };
    localStorage.setItem("state", JSON.stringify(state));
  }
  return state;
}

function render(){
  const state = loadState();
  overlay.innerHTML="";

  state.players.forEach((p,i)=>{
    if(typeof p.playerIndex!=="number" || !playersData[p.playerIndex]) return;
    const data = playersData[p.playerIndex];

    const player = document.createElement("div");
    player.className = "player" + (p.alive?"":" dead");

    const photoWrap = document.createElement("div");
    photoWrap.className="photo-wrap";

    // фото
    const img = document.createElement("img");
    img.className="photo";
    img.src=data.img;
    photoWrap.appendChild(img);

    // роль
    if(p.role && p.role!=="peaceful" && roles[p.role]){
      const roleImg=document.createElement("img");
      roleImg.className="role";
      roleImg.src=roles[p.role];
      photoWrap.appendChild(roleImg);
    }

    // имя
    const name=document.createElement("div");
    name.className="name";
    name.textContent=data.name;

    player.append(photoWrap,name);
    overlay.appendChild(player);

    prevAlive[i]=p.alive;
  });
}

setInterval(render,400);
render();
</script>

</body>
</html>
