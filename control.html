<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>OBS Control</title>
<link href="https://fonts.googleapis.com/css2?family=Raleway:900&display=swap" rel="stylesheet">
<style>
body { font-family: 'Raleway', sans-serif; background: #222; color: #fff; padding: 10px; }
.player-control { display: flex; align-items: center; margin-bottom: 8px; }
.player-control img { width: 40px; height: 40px; border-radius: 6px; margin-right: 6px; }
.player-control select, .player-control button { margin-right: 6px; }
</style>
</head>
<body>
<h2>Управление игроками</h2>
<div id="players-container"></div>
<script src="players.js"></script>
<script>
const container = document.getElementById("players-container");

// Инициализация state
function loadState() {
  let state = JSON.parse(localStorage.getItem("state"));
  if (!state) {
    state = { players: playersData.map((p, i) => ({ playerIndex: i, alive: true, role: "мирный" })) };
    localStorage.setItem("state", JSON.stringify(state));
  }
  return state;
}

function saveState(state) {
  localStorage.setItem("state", JSON.stringify(state));
}

// Рендер контролов
function renderControls() {
  const state = loadState();
  container.innerHTML = "";

  state.players.forEach((p, i) => {
    const data = playersData[p.playerIndex];
    const div = document.createElement("div");
    div.className = "player-control";

    const img = document.createElement("img");
    img.src = data.img;

    const name = document.createElement("span");
    name.textContent = data.name;

    // Кнопка "убить / оживить"
    const btn = document.createElement("button");
    btn.textContent = p.alive ? "Убить" : "Оживить";
    btn.onclick = () => {
      p.alive = !p.alive;
      saveState(state);
      renderControls();
    };

    // Выпадающий список ролей
    const select = document.createElement("select");
    for (const roleName in roles) {
      const option = document.createElement("option");
      option.value = roleName;
      option.textContent = roleName;
      if (p.role === roleName) option.selected = true;
      select.appendChild(option);
    }
    select.onchange = (e) => {
      p.role = e.target.value;
      saveState(state);
    };

    div.append(img, name, btn, select);
    container.appendChild(div);
  });
}

renderControls();
</script>
</body>
</html>
