<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>OBS Control</title>
<link href="https://fonts.googleapis.com/css2?family=Raleway:900&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Raleway', sans-serif;
  background: #222;
  color: #fff;
  padding: 10px;
}
h2 {
  margin-top: 0;
}
.player-row {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
}
.player-row img {
  width: 40px;
  height: 40px;
  border-radius: 6px;
  margin-right: 6px;
}
.player-row select, .player-row button {
  margin-right: 6px;
  cursor: pointer;
}
button {
  background: #444;
  color: #fff;
  border: none;
  padding: 4px 8px;
  border-radius: 4px;
}
button:hover {
  background: #666;
}
select {
  background: #333;
  color: #fff;
  border: none;
  padding: 4px;
  border-radius: 4px;
}
</style>
</head>
<body>

<h2>Управление игроками</h2>

<!-- Контейнер для строк игроков -->
<div id="players-container"></div>

<!-- Подключаем players.js -->
<script src="players.js"></script>

<script>
/* === Инициализация state === */
function loadState() {
  let state = JSON.parse(localStorage.getItem("state"));
  if (!state) {
    // дефолт: все игроки alive и мирные
    state = { players: playersData.map((p, i) => ({
      playerIndex: i,
      alive: true,
      role: "мирный"
    }))};
    localStorage.setItem("state", JSON.stringify(state));
  }
  return state;
}

function saveState(state) {
  localStorage.setItem("state", JSON.stringify(state));
}

/* === Рендер панели управления === */
function renderControl() {
  const container = document.getElementById("players-container");
  const state = loadState();
  container.innerHTML = "";

  state.players.forEach((p, i) => {
    const data = playersData[p.playerIndex];

    const row = document.createElement("div");
    row.className = "player-row";

    // Фото игрока
    const img = document.createElement("img");
    img.src = data.img;

    // Имя
    const name = document.createElement("span");
    name.textContent = data.name;

    // Кнопка "Убить/Оживить"
    const btn = document.createElement("button");
    btn.textContent = p.alive ? "Убить" : "Оживить";
    btn.onclick = () => {
      p.alive = !p.alive;
      saveState(state);
      renderControl();
    };

    // Выпадающий список ролей
    const select = document.createElement("select");
    for (const roleName in roles) {
      const option = document.createElement("option");
      option.value = roleName;
      option.textContent = roleName;
      if (p.role === roleName) option.selected = true;
      select.appendChild(option);
    }
    select.onchange = (e) => {
      p.role = e.target.value;
      saveState(state);
    };

    // Собираем строку
    row.appendChild(img);
    row.appendChild(name);
    row.appendChild(btn);
    row.appendChild(select);

    container.appendChild(row);
  });
}

/* === Запуск рендера === */
document.addEventListener("DOMContentLoaded", () => {
  renderControl();
});
</script>

</body>
</html>
